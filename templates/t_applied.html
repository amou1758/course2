{% extends "t_base.html" %}
{% block title %}
    已申请课程
{% endblock %}

{% block  head %}
    <style>
        .content {
            min-height: 500px;
        }

        #appfm p {
            text-align: center;
            font-size: 20px;
            color: rgb(93, 95, 97);
        }

        #appfm p small {
            text-align: center;
            color: red;
        }

        .table-div {
            padding-top: 10px;
        }

        .pass {
            background-color: lightgreen;
        }

        .nopass {
            background-color: red;
        }

        table thead {
            font-size: 15px;
        }

        table tbody {
            font-size: 10px;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container">
        <div class="content">
            <div class="table-div">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>课程号</th>
                        <th>课程名</th>
                        <th>课程类型</th>
                        <th>授课学院</th>
                        <th>上课地点</th>
                        <th>上课时间</th>
                        <th>学分</th>
                        <th>申请日期</th>
                        <th>课程上线时间</th>
                        <th>课程关闭时间</th>
                        <th>选课情况</th>
                        <th>审核状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% if applied_course_list %}
                        {% for c in applied_course_list %}
                            <tr class="trid" cno="{{ c.course_no }}"
                                cstatus="{{ c.course_status }}"
                                style="height: 50px"
                            >
                                <td>{{ c.course_no }}</td>
                                <td>{{ c.course_name }}</td>
                                <td>{{ c.get_course_type_display }}</td>
                                <td>{{ c.get_course_college_display }}</td>
                                <td>{{ c.get_course_classroom_display }}</td>
                                <td>{{ c.get_course_week_display }} {{ c.get_course_time_display }}</td>
                                <td>{{ c.course_credit }}</td>
                                <td>{{ c.course_applied_time }}</td>
                                {% if c.course_online_time %}
                                    <td>{{ c.course_online_time }}</td>
                                {% else %}
                                    <td> ——</td>
                                {% endif %}
                                {% if c.course_close_time %}
                                    <td>{{ c.course_close_time }}</td>
                                {% else %}
                                    <td> ——</td>
                                {% endif %}
                                {% if c.course_online %}
                                    <td>0/{{ c.course_total_people }}</td>
                                {% else %}
                                    <td> ——</td>
                                {% endif %}
                                {% if c.course_status == 1 %}
                                    <td>待审批</td>
                                    <td> ——</td>
                                {% elif c.course_status == 2 %}
                                    <td>审批通过</td>


                                    <td>&nbsp;<i class="fa fa-arrow-circle-up" aria-hidden="true" title="上线课程"
                                                 onclick="online(this)"></i></td>

                                {% elif c.course_status == 3 %}
                                    <td>审批未通过</td>
                                    <td> ——</td>
                                {% elif c.course_status == 4 %}
                                    <td>审批通过已上线</td>
                                    <td>&nbsp;<i class="fa fa-plus-square" aria-hidden="true" title="课程扩容"
                                                 onclick="extend(this)"></i></td>

                                {% endif %}
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="10"><h1 style="color: silver;text-align: center">目前暂为申请新课程</h1></td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    </div>
    <script>

        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
        });

        $("#nav3").addClass("active");
        $(function () {
            ChangeTableEvent();
        })

        function ChangeTableEvent() {
            var list = $(".trid")

            for (var i = 0; i < list.length; i++) {
                if (list.eq(i).attr("cstatus") == 2 || list.eq(i).attr("cstatus") == 4) {
                    $(".trid").eq(i).addClass("pass");
                } else if (list.eq(i).attr("cstatus") == 3) {
                    $(".trid").eq(i).addClass("nopass");
                }
            }
        }

        function online(t) {
            var cno = $(t).parent().parent().attr("cno");
            $.ajax({
                url: 'online',
                type: 'POST',
                dataType: 'JSON',
                data: {"cno": cno},
                success: function (arg) {
                    if (arg.status) {
                        window.location.reload()
                    }
                }
            })
        }

        function extend() {
            var cno = $(t).parent().parent().attr("cno");
            $.ajax({
                url: 'extend',
                type: 'POST',
                dataType: 'JSON',
                data: {"cno": cno},
                success: function (arg) {
                    if (arg.status) {
                        window.location.reload()
                    }
                }
            })
        }
    </script>
{% endblock %}